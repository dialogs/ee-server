---
- hosts: localhost
  connection: local
  roles:
    - role: packages
      tags: 'always'
      when: not ansible_check_mode
    
    - role: docker
      tags: 'docker'
    
    - role: docker-compose
      tags: 'docker-compose'
    
    - role: nginx
      dhparam_size: 1024
      dhparam_file: "/etc/ssl/dhparam.pem"
      tags: 'nginx'
   
    - role: geerlingguy.certbot
      certbot_auto_renew: true
      certbot_auto_renew_user: "{{ ansible_user }}"
      certbot_auto_renew_hour: 3
      certbot_auto_renew_minute: 30
      certbot_auto_renew_options: "--quiet --no-self-upgrade" 
    
    - role: haproxy
      frontend_mode: 'tcp'
      backend_server: '127.0.0.1:9070'
      tags: 'haproxy'

    - role: dlg-compose
      tags: 'dlg-compose'

    - role: dlg-config
      tags: 'dlg-config'
